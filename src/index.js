var everyoneDrinks = [
    "Drink if you went to college",
    "Drink if you have kids",
    "Drink if you are an aunt or uncle",
    "Drink if you like sports",
    "Drink if you have a pet",
    "Drink if you have had sex in the past 48 hours",
    "Drink if you have ever been cat called",
    "Drink if you have two eyes",
    "Drink if you hate Trump",
    "Drink if you are from the East Coast",
    "Drink if you are from the West Coast",
    "Drink if you went to the nail salon within the past month",
    "Drink if you are an asshole",
    "Drink if you like musicals",
    "Drink if you play video games",
    "Drink if you have an iPhone",
    "Drink if you have an Android",
    "Drink if you like tacos",
    "Drink if you like pina cooladas and getting caught in the rain",
    "Drink if you have ever cried watching Titanic",
    "Drink if you have ever run over a squirrel",
    "Drink if you have glasses",
    "Drink if you love sushi",
    "Drink if you had the most recent birthday",
    "Drink if you are the youngest",
    "Drink if you are the oldest",
    "Drink if you are the shortest",
    "Drink if you have longest hair",
    "Drink if you are the nicest person in the room",
    "Drink if you are the biggest asshole in the room",
    "Drink if you are the nerdiest person in the room",
    "Drink if you are most likely to end up naked, outside your grandma's rosebush at 4am",
    "Drink if you are most likely to be a millionare",
    "Drink if you are the most athletic",
    "Drink if you are the person most likely to go to bed at 9pm ",
    "Drink if you are the person that is most likely to end up with 18 cats, 9 dogs and athritis ",
    "The person most likely to bring an escort to the mall for a date",
    "Drink if you are the person most likely to streak at a sporting event",
    "Drink if you are most likely to have a Britney Spears breakdown"
]

var triviaQuestions = [
    {
        'question' : 'Who was the 9th US president?'
        , 'answer' : 'William Henry Harrison'
    } ,
    {
        'question' : 'Where is the comedian, Adam Sandler, from?'
        , 'answer' : 'Manchester, NH'
    } ,
    {
        'question' : 'On which island was Napoleon exiled following his defeat in Waterloo?'
        , 'answer' : 'St. Helena'
    } ,
    {
        'question' : 'What US state is the Flagstaff Pulliam Airport located in?'
        , 'answer' : 'Arizona'
    } ,
    {
        'question' : 'What US state is the Pocatello Regional Airport located in?'
        , 'answer' : 'Idaho'
    } ,
    {
        'question' : 'What US state is the Cincinnati Municipal Lunken Airport located in?'
        , 'answer' : 'Ohio'
    } ,
    {
        'question' : 'What US state is the Palm Springs International Airport located in?'
        , 'answer' : 'California'
    } ,
    {
        'question' : 'What US state is the Cheyenne Regional Airport located in?'
        , 'answer' : 'Wyoming'
    } ,
    {
        'question' : 'Who plays Dwight Schrute on the US version of The Office?'
        , 'answer' : 'Rainn Wilson'
    } ,
    {
        'question' : 'Who is the female lead in the 1978 version of the movie Halloween?'
        , 'answer' : 'Jamie Lee Curtis'
    } ,
    {
        'question' : 'What is the largest fish in the ocean?'
        , 'answer' : 'Whale shark'
    } ,
    {
        'question' : 'Where were cats presumed to be first domesticated?'
        , 'answer' : 'Egypt'
    } ,
    {
        'question' : 'Who was the first man on the moon?'
        , 'answer' : 'Neil Armstrong'
    } ,
    {
        'question' : 'Who is the lead signer of A C D C'
        , 'answer' : 'Brian Johnson'
    } ,
    {
        'question' : 'How many continents are in the world?'
        , 'answer' : 'Seven'
    } ,
    {
        'question' : 'Which countrys national emblem is the beaver'
        , 'answer' : 'Canada'
    } ,
    {
        'question' : 'How many players are on the field in a baseball game?'
        , 'answer' : 'Nine'
    } ,
    {
        'question' : 'What is the name of Batmans butler?'
        , 'answer' : 'Alfred'
    } ,
    {
        'question' : 'Which element is N A?'
        , 'answer' : 'Sodium'
    } ,
    {
        'question' : 'What city is the capital of China?'
        , 'answer' : 'Beijing'
    } ,
    {
        'question' : 'What is the most commonly spoken language in the world?'
        , 'answer' : 'Chinese'
    } ,
    {
        'question' : 'What kind of tree do acorns grow on?'
        , 'answer' : 'Oak'
    } ,
    {
        'question' : 'How many colors are in the rainbow?'
        , 'answer' : 'Seven'
    } ,
    {
        'question' : 'In fitness, what does the acronym "BMI" stand for?'
        , 'answer' : 'Body Mass Index'
    } ,
    {
        'question' : 'What is the capital of North Dakota?'
        , 'answer' : 'Bismark'
    } ,
    {
        'question' : 'Who is Spongebobs best friend'
        , 'answer' : 'Patrick'
    } ,
    {
        'question' : 'What street did Sherlock Holmes live on?'
        , 'answer' : 'Baker Street'
    } ,
    {
        'question' : 'What do the birds say in Finding Nemo?'
        , 'answer' : 'Mine!'
    } ,
    {
        'question' : 'When did the movie The Lion King come out?'
        , 'answer' : '1994'
    } ,
    {
        'question' : 'Where did the Titanic set sail from?'
        , 'answer' : 'Southampton'
    } ,
    {
        'question' : 'What does corgi mean?'
        , 'answer' : 'Dward dog'
    } ,
    {
        'question' : 'Do dogs dream?'
        , 'answer' : 'Yes.'
    } ,
    {
        'question' : 'When did Monopoly come out?'
        , 'answer' : '1935'
    } ,
    {
        'question' : 'What day of the week is Canadian Thankgiving on?'
        , 'answer' : 'Monday'
    } ,
    {
        'question' : 'What Disney movie is the song A Whole New World from?'
        , 'answer' : 'Aladdin'
    } ,
    {
        'question' : 'What was Rudolphs fathers name'
        , 'answer' : 'Donner'
    } ,
    {
        'question' : 'Where did Halloween originate?'
        , 'answer' : 'Ireland'
    } ,
    {
        'question' : 'How many times have the red sox won the world series?'
        , 'answer' : '8'
    } ,
    {
        'question' : 'Who has won the world series the most amount of times?'
        , 'answer' : 'Yankees'
    } ,
    {
        'question' : 'How many teams are in the NBA?'
        , 'answer' : '30'
    } ,
    {
        'question' : 'Which of Shakespeares plays is the longest'
        , 'answer' : 'Hamlet'
    } ,
    {
        'question' : 'Which Shakespeare play is the following quote from: All the perfumes of Arabia will not sweeten' +
            'this little hand'
        , 'answer' : 'Macbeth'
    } ,
    {
        'question' : 'What is a group of cats called?'
        , 'answer' : 'Clowder'
    } ,
    {
        'question' : 'What does the acronym E A stand for?'
        , 'answer' : 'Electronic Arts'
    } ,
    {
        'question' : 'What year did Alexa originate?'
        , 'answer' : '2015'
    } , {
        'question' : 'What band sings the theme song to the popular 90s show Friends'
        , 'answer' : 'The Remembrandts'
    }

];


// Route the incoming request based on type (LaunchRequest, IntentRequest,
// etc.) The JSON body of the request is provided in the event parameter.
exports.handler = function (event, context) {
    try {
        console.log("event.session.application.applicationId=" + event.session.application.applicationId);

        /**
         * Uncomment this if statement and populate with your skill's application ID to
         * prevent someone else from configuring a skill that sends requests to this function.
         */

        // if (event.session.application.applicationId !== "") {
        //     context.fail("Invalid Application ID");
        //  }

        if (event.session.new) {
            onSessionStarted({requestId: event.request.requestId}, event.session);
        }

        if (event.request.type === "LaunchRequest") {
            onLaunch(event.request,
                event.session,
                function callback(sessionAttributes, speechletResponse) {
                    context.succeed(buildResponse(sessionAttributes, speechletResponse));
                });
        } else if (event.request.type === "IntentRequest") {
            onIntent(event.request,
                event.session,
                function callback(sessionAttributes, speechletResponse) {
                    context.succeed(buildResponse(sessionAttributes, speechletResponse));
                });
        } else if (event.request.type === "SessionEndedRequest") {
            onSessionEnded(event.request, event.session);
            context.succeed();
        }
    } catch (e) {
        context.fail("Exception: " + e);
    }
};

/*
 * Called when the session starts.
 */
function onSessionStarted(sessionStartedRequest, session) {
    // add any session init logic here
}

/**
 * Called when the user invokes the skill without specifying what they want.
 */
function onLaunch(launchRequest, session, callback) {
    getWelcomeResponse(callback);
}

/**
 * Called when the user specifies an intent for this skill.
 */
function onIntent(intentRequest, session, callback) {

    // dispatch custom intents to handlers here
    if (intentRequest.intent.name == "LetsPlayIntent") {
        handleLetsPlay(intentRequest, session, callback);
    }
}

/**
 * Called when the user ends the session.
 * Is not called when the skill returns shouldEndSession=true.
 */
function onSessionEnded(sessionEndedRequest, session) {

}

// ------- Skill specific logic -------

function getWelcomeResponse(callback) {
    var speechOutput = "Get ready. If you're not drunk enough already, this game will get you drunker. Play with as " +
        "many people as you want...including if it's just you, you alcoholic. To begin, say let's play.";

    var reprompt = "Say let's play.";

    var header = "This game will get you drunker!";

    var shouldEndSession = false;

    var sessionAttributes = {
        "speechOutput" : speechOutput
        , "repromptText" : reprompt
    };

    callback(sessionAttributes, buildSpeechletResponse(header, speechOutput, reprompt, shouldEndSession));
}

function  handleLetsPlay(intent, session, callback) {
    var triviaObject = handleTrivia();
    var speechOutput = triviaObject.question;

    if (Math.random() > .4) {
        speechOutput = everyoneDrinks[Math.floor(Math.random() * everyoneDrinks.length)];
    } else {
        var trivia = handleTrivia();
        speechOutput = trivia.question;
    }

    var reprompt = speechOutput + "or say let's play for another drink";

    var header = "This game will get you drunker!";

    var sessionAttributes = {
        "speechOutput" : speechOutput
        , "repromptText" : reprompt
    };

    var shouldEndSession = false;

    callback(sessionAttributes, buildSpeechletResponse(header, speechOutput, reprompt, shouldEndSession));
}

function handleTrivia() {
    var triviaQuestion = triviaQuestions[Math.floor(Math.random() * triviaQuestions.length)];
    return {
        "question" : 'Trivia Round everyone! Im going to ask you all a question. If no one answers right, ' +
        'everyone drinks...hopefully, you are not all idiots. Heres your question: ' + triviaQuestion.question,
        "answer" : triviaQuestion.answer
    };
}


function correctTriviaAnswer() {
    this.emit('You got it right! Wow Im shocked...');
    resetLetsPlay();
}

function incorrectTriviaAnswer() {
    this.emit('Shocker...you are wrong. DRINK EVERYONE!!!');
    resetLetsPlay();
}

function resetLetsPlay() {
    this.emit('Say lets play for...anotha one');
}

function everyoneDrinks() {
    var speechOutput = everyoneDrinks[Math.floor(Math.random() * everyoneDrinks.length)];
    return speechOutput;
}

function handleGetHelpRequest(intent, session, callback) {
    // Ensure that session.attributes has been initialized
    if (!session.attributes) {
        session.attributes = {};

    }
}

function handleFinishSessionRequest(intent, session, callback) {
    // End the session with a "Good bye!" if the user wants to quit the game
    callback(session.attributes,
        buildSpeechletResponseWithoutCard("You better all be drunk...bye!", "", true));
}


// ------- Helper functions to build responses for Alexa -------


    function buildSpeechletResponse(title, output, repromptText, shouldEndSession) {
        return {
            outputSpeech: {
                type: "PlainText",
                text: output
            },
            card: {
                type: "Simple",
                title: title,
                content: output
            },
            reprompt: {
                outputSpeech: {
                    type: "PlainText",
                    text: repromptText
                }
            },
            shouldEndSession: shouldEndSession
        };
    }

    function buildSpeechletResponseWithoutCard(output, repromptText, shouldEndSession) {
        return {
            outputSpeech: {
                type: "PlainText",
                text: output
            },
            reprompt: {
                outputSpeech: {
                    type: "PlainText",
                    text: repromptText
                }
            },
            shouldEndSession: shouldEndSession
        };
    }

    function buildResponse(sessionAttributes, speechletResponse) {
        return {
            version: "1.0",
            sessionAttributes: sessionAttributes,
            response: speechletResponse
        };
    }